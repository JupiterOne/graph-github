# v5.1.1 (Wed Jul 10 2024)

#### üêõ Bug Fix

- remove secret property from secret scanning findings [#306](https://github.com/JupiterOne/graph-github/pull/306) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v5.1.0 (Wed Jul 10 2024)

#### üöÄ Enhancement

- include secretScanningAlerts step back again [#305](https://github.com/JupiterOne/graph-github/pull/305) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v5.0.0 (Wed May 15 2024)

#### üí• Breaking Change

- Remove actions handler [#302](https://github.com/JupiterOne/graph-github/pull/302) ([@Nick-NCSU](https://github.com/Nick-NCSU))

#### üêõ Bug Fix

- Fix tests dates [#301](https://github.com/JupiterOne/graph-github/pull/301) ([@Nick-NCSU](https://github.com/Nick-NCSU))

#### Authors: 1

- Nick Thompson ([@Nick-NCSU](https://github.com/Nick-NCSU))

---

# v4.3.2 (Thu Apr 25 2024)

#### üêõ Bug Fix

- Update Dockerfile [#300](https://github.com/JupiterOne/graph-github/pull/300) ([@zemberdotnet](https://github.com/zemberdotnet))

#### Authors: 1

- Matthew Zember ([@zemberdotnet](https://github.com/zemberdotnet))

---

# v4.3.1 (Wed Mar 20 2024)

#### üêõ Bug Fix

- skip empty pull requests response object [#299](https://github.com/JupiterOne/graph-github/pull/299) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.3.0 (Tue Mar 19 2024)

#### üöÄ Enhancement

- change pull requests query approach to consume > 1000 PRs [#298](https://github.com/JupiterOne/graph-github/pull/298) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.2.2 (Tue Mar 12 2024)

#### üêõ Bug Fix

- fix scopes' info log [#297](https://github.com/JupiterOne/graph-github/pull/297) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.2.1 (Tue Mar 12 2024)

#### üêõ Bug Fix

- add scopes log; fix issues totalCount field on repos [#296](https://github.com/JupiterOne/graph-github/pull/296) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.2.0 (Tue Feb 27 2024)

#### üöÄ Enhancement

- add config options to change ingestion window for PRs and issues [#295](https://github.com/JupiterOne/graph-github/pull/295) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.1.0 (Tue Feb 27 2024)

#### üöÄ Enhancement

- Add authentication type for enterprise PATs [#294](https://github.com/JupiterOne/graph-github/pull/294) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.0.4 (Wed Feb 14 2024)

#### üêõ Bug Fix

- log metrics to debug external identity issues [#293](https://github.com/JupiterOne/graph-github/pull/293) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.0.3 (Tue Feb 13 2024)

#### üêõ Bug Fix

- fix pagination for external identities query [#292](https://github.com/JupiterOne/graph-github/pull/292) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.0.2 (Fri Jan 05 2024)

#### üêõ Bug Fix

- INT-10119 - split issues query for labels and assignees [#291](https://github.com/JupiterOne/graph-github/pull/291) ([@RonaldEAM](https://github.com/RonaldEAM))

#### ‚ö†Ô∏è Pushed to `main`

- Apply remove-codeql with multi-gitter [ci skip] ([@electricgull](https://github.com/electricgull))

#### Authors: 2

- Cameron Griffin ([@electricgull](https://github.com/electricgull))
- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.0.1 (Mon Dec 11 2023)

#### üêõ Bug Fix

- INT-10071 - handle gateway timeout for repos step [#290](https://github.com/JupiterOne/graph-github/pull/290) ([@RonaldEAM](https://github.com/RonaldEAM))

#### ‚ö†Ô∏è Pushed to `main`

- Fix x-cortex-service-groups where tier-4 was set incorrectly ([@jablonnc](https://github.com/jablonnc))

#### Authors: 2

- Noah Jablonski ([@jablonnc](https://github.com/jablonnc))
- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# v4.0.0 (Mon Dec 04 2023)

#### üí• Breaking Change

- Release graphql improvements [#289](https://github.com/JupiterOne/graph-github/pull/289) ([@RonaldEAM](https://github.com/RonaldEAM))

#### üêõ Bug Fix

- Setup beta branch [#285](https://github.com/JupiterOne/graph-github/pull/285) ([@RonaldEAM](https://github.com/RonaldEAM))

#### Authors: 1

- Ronald Arias ([@RonaldEAM](https://github.com/RonaldEAM))

---

# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to
[Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## 3.6.0 - 2023-07-31

### Added

- Organization external identifiers are now used when available to resolve
  member email addresses.

## 3.5.1 - 2023-07-28

### Added

- Added validate invocation to the invocation config.

## 3.5.0 - 2023-07-28

### Changed

- Refactored validateInvocation to support SDK changes.

## 3.4.0 - 2023-07-25

### Added

- Introduced an additional configuration field PULL_REQUEST_MAX_SEARCH_LIMIT for
  limiting pull request searches.

## 3.3.0 - 2023-07-05

### Changed

- Removed `config.enableDependabotAlerts` option since Ingestion Source Configs
  replaces this feature.
- Removed `ENABLE_DEPENDABOT_ALERTS` as an environment variable since Ingestion
  Source Configs replaces this feature.

## 3.2.0 - 2023-07-03

### No functional changes were made.

## 3.1.0 - 2023-06-28

### Changed

- Add `sourceRefOid` and `targetRefOid` properties to the PullRequest entity.

## 3.0.1 - 2023-06-21

### Changed

- Improved labels/descriptions for ingestion sources.

## 3.0.0 - 2023-06-21

### Changed

- Upgraded to Node 18

## 2.5.1 - 2023-05-22

- Upgraded to SDK packages 8.41.0

## 2.5.0 - 2023-05-18

### Added

- Introduced Ingestion Sources to enable the Data Config feature
- Upgraded to SDK packages 8.40.0

## 2.4.0 - 2023-05-04

### Added

- The following property has been added to `github_finding`:

| Property          | Type     |
| ----------------- | -------- |
| `dependencyScope` | `string` |

## 2.3.0 - 2023-05-01

### Added

- The following properties have been added to `github_repo`:

| Property     | Type     |
| ------------ | -------- |
| `visibility` | `string` |

## 2.2.2 - 2023-03-23

### Changed

- **BREAKING**: The `fixReason` property has been removed from `github_finding`
  entities. The `fixReason` field returned by GitHub's `vulnerabilityAlerts`
  GraphQL API has been deprecated and is set to be removed at the end of
  03-2023.

- Revert changes released in v2.2.1. The `fixedOn` is _not_ being removed from
  the GitHub API. Instead, the `fixReason` property is being removed.

## 2.2.1 - 2023-03-22

### Changed

- **BREAKING**: The `fixedOn` property has been removed from `github_finding`
  entities. The `fixedAt` field returned by GitHub's `vulnerabilityAlerts`
  GraphQL API has been deprecated and is set to be removed at the end of
  03-2023.

## 2.0.3 - 2023-03-06

### Changed

- Code Scanning alert step will now self-disabled if the GHE version (<3.5.0)
  does not support Organization level code scanning alerts ingestion.

## 2.0.2 - 2023-02-23

### Changed

- Fixed type error seen in updated deployment
- Re-enabled Branch Protection Rule test

## 2.0.1 - 2023-02-17

### Fixed

- Branch Protection Rule query support for GitHub Enterprise versions 3.6.0 and
  3.5.0 contained a bug and was fixed.

## 2.0.0 - 2023-02-15

### Added

- New data collection step was added: Code Scanning Alerts

The following entities were added:

| Resources                   | Entity `_type`                 | Entity `_class` |
| --------------------------- | ------------------------------ | --------------- |
| GitHub Code Scanning Alerts | `github_code_scanning_finding` | `Finding`       |

The following relationships were added:

| Source Entity `_type` | Relationship `_class` | Target Entity `_type`          |
| --------------------- | --------------------- | ------------------------------ |
| `github_repo`         | **HAS**               | `github_code_scanning_finding` |

## Changed

- @octokit/rest was updated to v19.0.3
- @jupiterone/integration-sdk-\* were updated to v8.30.2
- Testing har and snap files now use JupiterOne-Sandbox GitHub organization

## 1.23.5 - 2023-02-14

### Added

- Added Branch Protection Rule query support for GitHub Enterprise versions
  3.6.0 and 3.5.0.

## 1.23.4 - 2022-12-16

### Added

- Added `filesChangedCount` property to `github_pull_request`

## 1.23.2 - 2022-11-29

### Changed

- Add a buffer (of one polling interval) to the start datetime of PR ingestion.
  This will allow any missed updates to be re-queried and included in the next
  ingestion round.

## 1.23.1 - 2022-10-31

### Changed

- Updated permissions for branch protection rules step to include
  `repo discussions:read-only` to allow private repo rules to be ingested.

## 1.23.0 - 2022-10-17

### Added

- ingest github pages (new permission will be requested by github app)

## 1.22.0 - 2022-09-20

### Added

- Added relationship between two pull requests that share the same merge commit.
  This allows for discovery of pull request merges without approval given the
  following scenario:

  > PR1 - Branch A -> main with commit {A} PR2 - Branch B -> main with commits
  > {A, B} PR3 - Branch C -> main with commits {A, B, C}

  If PR3 is merged first, PR1 and PR2 will be marked as MERGED and potentially
  without approval in some circumstances. This new CONTAINS relationship will
  indicate that PR3 ->CONTAINS-> (PR1 | PR2)

| Source Entity `_type` | Relationship `_class` | Target Entity `_type` |
| --------------------- | --------------------- | --------------------- |
| `github_pullrequest`  | **CONTAINS**          | `github_pullrequest`  |

### Fixed

- `github_pullrequest` entity property `allCommitsApproved` will now only be set
  if commits are available on a given pull request. If a repo is private,
  permissions don't allow us to pull commit history.

## 1.21.2 - 2022-09-15

### Fixed

- Fixed branch protection rules logic to only add relationship when the user is
  known.

### Added

- Added `bypassPullRequestAllowance` property to OVERRIDES relationship between
  (github_user|github_app|github_team) and branch protection rule.

## 1.21.1 - 2022-09-14

## Changed

- Changed step permissions for branch protection rules.

## 1.21.0 - 2022-09-13

### Added

- Added `branchProtectionRules` step with the following entity and
  relationships:

| Resources                      | Entity `_type`                  | Entity `_class` |
| ------------------------------ | ------------------------------- | --------------- |
| GitHub Branch Protection Rules | `github_branch_protection_rule` | `Rule`          |

| Source Entity `_type` | Relationship `_class` | Target Entity `_type`           |
| --------------------- | --------------------- | ------------------------------- |
| `github_team`         | **OVERRIDES**         | `github_branch_protection_rule` |
| `github_repo`         | **HAS**               | `github_branch_protection_rule` |
| `github_user`         | **OVERRIDES**         | `github_branch_protection_rule` |
| `github_app`          | **OVERRIDES**         | `github_branch_protection_rule` |

### Changed

- Property `databaseId` type was change from `string` to `number`

## 1.20.0 - 2022-08-19

### Changed

- Added `pullRequestMaxResourcesPerRepo` to config to allow the max limit of
  pull requests to be adjusted. Default remains at 500 per repo.

## 1.19.0 - 2022-07-14

### Changed

- Added `pullRequestIngestStartDatetime` to config to allow pull request
  ingestion to start at a specified date.
- Update the GitHub Finding property name. (Summary -> description).

## 1.18.0 - 2022-07-01

### Changed

- Added disabled step reasons to getStepStartStates
- Updated integration-sdk-\* versions to 8.18.0

## 1.17.4 - 2022-06-27

### Fixed

- Duplicate PR keys now also prevent duplicate relationships from being created.

## 1.17.3 - 2022-06-24

### Fixed

- Duplicate PR keys are now being caught, logged, and skipped. Duplication
  should only be happening in rare instances such as when a new PR is entered
  during ingestion and pagination is shifted.

## 1.17.2 - 2022-06-23

### Changed

- Eliminated the unused config value `githubInstallationId`.
- Update action return types.

## 1.17.1 - 2022-06-22

### Fixed

- `validateInvocation` now uses /meta endpoint. Establishes the version of GHE
  Server, as applicable.
- Based on the GHE Server version, the Vulnerability Alert queries are modified.
- Vulnerability Alert converter was updated to handle the less verbose response
  from older versions.

## 1.17.0 - 2022-06-22

### Fixed

- Finding relationships to CWE and CVE are now mapped relationships and do not
  create direct relationships.

## 1.16.0 - 2022-06-14

### Added

- Added ability to enable/disable ingestion of Dependabot vulnerability
  findings. Includes finding filter options on status and severity.

## 1.15.2 - 2022-05-26

### Fixed

- Modified Vulnerability to CVE/CWE mapped relationship to correct properties.

## 1.15.1 - 2022-05-25

### Fixed

- Fixed buildVulnAlertRecommendation() to handle responses without
  `firstPatchedVersion`.
- Changed Vulnerability Alert to CVE/CWE from a direct relationship to a mapped
  relationship.

## 1.15.0 - 2022-05-23

### Added

- Added Vulnerability Alerts (aka Dependabot Alerts) ingestion step. In order to
  enable, this requires the Dependabot Alert read-only permission.

## 1.14.0 - 2022-05-17

### Added

- Added action handler to process real-time entity ingestion. (v1)

## 1.13.1 - 2022-05-05

### Fixed

- `integration-question-github-how-often-are-github-secrets-rotating` 90 days
  managed question to have `- 90 days`

### Changed

- Added `code-ql` and `questions` workflow

## 1.13.0 - 2022-05-04

### Changes

- Promoted all 1.12.0-beta\* fixes.

## 1.12.0-beta.10 - 2022-04-29

### Fixed

- Fixed refreshToken in GraphQL client to use correct baseUrl.

## 1.12.0-beta.9 - 2022-04-28

### Fixed

- Updated error handling to match new @octokit/graphql.js error structure.
- Updated README for GraphQL client.
- Errors now return partial data responses when possible.

## 1.12.0-beta.8 - 2022-04-27

### Changes

- Moved to @octokit/graphql.js as our client to improve error handling.
- Updated @octokit/\* packages and removed redundant packages from
  `devDependencies`.

## 1.12.0-beta.7 - 2022-04-22

### Fixed

- Added improve retry logic during timeouts.
- Added enhanced debug logging. Set environment variable `LOG_LEVEL=trace` to
  see.

### Changes

- Updated integration-sdk-\* packages to version 8.12.1

## 1.12.0-beta.6 - 2022-04-22

### Fixed

- Fixed issue when a single PR was queried for multiple inner resources.

## 1.12.0-beta.5 - 2022-04-18

### Fixed

- Rate limit is no longer a required value in GraphQL responses. This supports
  GHE configuration where rate limiting is turned off.

## 1.12.0-beta.4 - 2022-03-31

### Changed

- Marked GitHub Issues ingestion step as `partial` allowing existing issues to
  remain in the graph.

## 1.12.0-beta.3 - 2022-03-29

### Changed

- Identified known GraphQL errors (see README.md)
- Introduced clear error handling
- Upgraded graphql.js package

## 1.12.0-beta.2 - 2022-03-25

### Changed

- Continued GraphQL pagination refactor for all queries.
- Renamed `createApiClient()` to `getOrCreateApiClient()` and moved to a
  singleton pattern to prevent unnecessary authentication requests.
- `createQueryExecutor` now accepts a `rateLimit` object, as a starting point,
  and the GraphQLClient keeps track of the `rateLimit` after each step.
- Additional fixes

## 1.12.0-beta.1 - 2022-03-16

### Changed

- Introduces new GraphQL pagination pattern for Pull Request entities. This beta
  release is to prove the changes in various environments before completing the
  refactor.

## 1.11.1 - 2022-03-01

### Changed

- Updated support for GitHub Enterprise Server within a managed environment.
  Allowing users to specify config for their instance.

### 1.11.0 - 2022-02-24

### Added

- Added support for a self-hosted GitHub Enterprise Server. Supply the URL to
  the instance via GITHUB_API_BASE_URL environment variable.

### 1.10.0 - 2022-02-21

### Added

- Added property `organizationId` to `github_user` Entity, to make it more
  convenient to track users from multiple organizations.

### 1.9.1 - 2022-01-26

### Changed

- Optimized queries in `fetch-team-members` and `fetch-team-repos` to fetch the
  ideal number of teams necessary to reach desired data.

### 1.9.0 2022-01-20

### Added

- `github_user` property `active` added, a boolean which is always true in the
  case of GitHub Users, to conform with new SDK standards for User entities

### Changed

- Added logging of token scopes for troubleshooting purposes
- Updated documentation with notes on GitHub App scope details
- Truncate potentially large `body` and `bodyText` property values from
  `github_issue`
- Remove `body` and `bodyText` property values from `github_issue` raw data

### 1.8.18 2022-01-04

### Changed

- Additional logging to pull request iteration

### 1.8.17 2021-12-06

### Fixed

- If multiple teams are returned by the GraphQL API for a single slug, the
  integration filters for the team it is working with at that moment instead of
  throwing duplicate relationship errors
- Issues can now discover outside collaborators for CREATED and ASSIGNED
  relationships
- Updated tests to match the single-team queries for team-members and team-repos
  that are being used by the ingestion code

### 1.8.16

### Removed

- The `handleTimeout` method when handling graphQL calls as it caused a promise
  to never get resolved. Timeout errors are now handled in a way that resolves
  all promises properly.

### 1.8.15

### Added

- Order to team-repos and team-members graphQL queries to ensure the correct
  team is selected.

### Changed

- Moved GraphQL sleep for rate limit outside of retry functions, and restored
  GraphQL retry timeout to 3 minutes so catch errors where Node hangs without a
  thrown error.

### 1.8.14

### Changed

- `github_team_has_user`, `github_user_manages_team`, and
  `github_repo_allows_team` relationships will not be made if a relationship
  with the same key has already been ingested in the same integration run.

## 1.8.13 - 2021-11-29

### Fixed

- Children resources in graphQL queries will now be cursed through instead of
  only getting the first 100 resources.
- Children resource cursors are now being properly handled which prevents
  ingesting the same child resource muliple times.

### Changed

- Changed GraphQL timeout 1 hour so it doesn't interfere with GraphQL sleep for
  rate limit

## 1.8.12 - 2021-11-26

### Added

- A GraphQL timeout of two minutes to prevent infinite hanging of integration
  runs.

## 1.8.11 - 2021-11-23

### Fixed

- Made `fetch-collaborators`, `fetch-team-repos` and `fetch-team-members` ingest
  entities in small batches to eliminate cursor confusion and timeouts on large
  datasets

## 1.8.10 - 2021-11-20

### Fixed

- Fixed broken cursor handling for nested objects, which made some larger
  GraphQL queries never terminate.

## 1.8.9 - 2021-11-19

### Changed

- Added logs for pagination details

## 1.8.7 - 2021-11-18

### Changed

- Separated `fetch-teams` step into three steps so that any crashes have less
  impact. The 3 steps are `fetch-teams`, `fetch-team-repos` and
  `fetch-team-members`. Step `fetch-teams` just gets the team entities and the
  relationship `github_account` HAS `github_team`. Step `fetch-team-repos`
  ingests the `github_repo` ALLOWS `github_team` relationship. Step
  `fetch-team-members` ingests the relationships `github_team` HAS `github_user`
  and `github_user` MANAGES `github_team`.
- Improved logs

### Fixed

- Fixed crash on `fetch-env-secrets` when the GitHub App was not authorized for
  environmental secrets on a subset of repos (403 error)
- Fixed unnecessary dependency where `fetch-collaborators` was waiting on
  `fetch-teams`, which in turn delayed `fetch-prs`.
- Fixed some instances where async functions were not being properly awaited.
- Added check to avoid invoking and logging sleep function for negative time.

## 1.8.6 - 2021-11-15

### Fixed

- Fixed duplicate key error for when Environments of the same name exist on
  multiple repositories, and they have Secrets with the same name.
- Fixed crash on `fetch-repo-secrets` when the GitHub App was not authorized for
  all repos (403 error)
- Fixed token expiration after sleep due to rate-limiting

## 1.8.5 - 2021-11-06

- Properly handle cases when GitHub does not return expected array properties
  from the GraphQL API

## 1.8.4 - 2021-11-05

### Changed

- Increased tolerance for delays due to GraphQL API errors, to upto 1 hour.

- Integration now respects `resetAt` property of rate-limiting messages to
  better predict when the API will permit further usage

- Integration begins to slow down when rate limits are 90% used, to reduce
  impact and contention with any other automation running against this account's
  API limits

## 1.8.3 - 2021-11-05

### Changed

- Additional GraphQL failure debug logging

## 1.8.2 - 2021-11-05

- Improved error messaging when a non-rate limit error occurs

## 1.8.1 - 2021-11-05

### Fixed

- An error in the error handler for certain GraphQL API failures

## 1.8.0 - 2021-11-04

### Fixed

- When GitHub returns `null` for `hasTwoFactorEnabled` due to permissions
  limitations, `github_user` property `mfaEnabled` will now be set to
  `undefined` instead of `false`
- When a step takes more than an hour to complete, the GraphQL client can now
  request a new API token on the fly without losing track of where it was

## 1.7.3 - 2021-10-27

### Changed

- Better error handling, including support for when GitHub rate-limiting errors
  are provided with non-error (200) codes.

## 1.7.1 - 2021-10-21

### Added

- Property `id` to `github_member` entities

### Changed

- Always throw an `IntegrationError` when repository environment secrets can not
  be ingested.
- Separated out `fetch-env-secrets` step from the `fetch-environments` step

### Fixed

- Changed incorrectly spelled `github_app` property `respositorySelected` to
  `repositorySelected`

## 1.7.0 - 2021-10-18

### Added

- Properties `forkingAllowed` and `forkCount` to RepoEntity

## 1.6.3 - 2021-10-18

### Changed

- Only retry graphQL errors 5 times instead of 10.
- Only query for the limit of `github_pull_request`s and `github_issue`s instead
  of the limit +1.
- Request fewer repositiories in a single calls in the `fetch-teams` step.
- Request fewer repositories and collaborators in a single call in the
  `fetch-collaborators`.
- Format graphQL errors even better.
- Do not throw an `IntegrationError` when the integration does not have access
  to environment secrets.
- Add a JobLog item when environment secrets could not be ingested due to a
  `403` error.

## 1.6.2 - 2021-10-15

## Fixed

- Log graphQL errors properly.

## 1.6.1 - 2021-10-15

- Increase `github_pull_request` limit from 100 to 500.

## 1.6.0 - 2021-10-15

### Fixed

- Crash on fetch-environments for private repos in accounts that are not
  Enterprise level

### Added

- Added support for ingesting labels on PullRequests
- Added support for ingesting the following **new** entity:

| Resources    | Entity `_type` | Entity `_class` |
| ------------ | -------------- | --------------- |
| GitHub Issue | `github_issue` | `Issue`         |

- Added support for ingesting the following **new** relationships:

| Source Entity `_type` | Relationship `_class` | Target Entity `_type` |
| --------------------- | --------------------- | --------------------- |
| `github_repo`         | **HAS**               | `github_issue`        |
| `github_user`         | **CREATED**           | `github_issue`        |
| `github_user`         | **ASSIGNED**          | `github_issue`        |

### Changed

- Migrated fetch-collaborators to GraphQL instead of REST for improved
  performance
- Removed redundant property API calls in several GraphQL queries

## 1.5.1 - 2021-10-06

### Changed

- All new boolean properties added in v1.5.0 that included `is` to no longer
  include `is`. Ex: `isLocked` became `locked`.

## 1.5.0 - 2021-09-28

### Added

- Added support for ingesting the following **new** entities:

| Resources          | Entity `_type`       | Entity `_class` |
| ------------------ | -------------------- | --------------- |
| GitHub Environment | `github_environment` | `Configuration` |
| GitHub Env Secret  | `github_env_secret`  | `Secret`        |

- Added support for ingesting the following **new** relationships:

| Source Entity `_type` | Relationship `_class` | Target Entity `_type` |
| --------------------- | --------------------- | --------------------- |
| `github_repo`         | **HAS**               | `github_environment`  |
| `github_environment`  | **HAS**               | `github_env_secret`   |
| `github_env_secret`   | **OVERRIDES**         | `github_org_secret`   |
| `github_env_secret`   | **OVERRIDES**         | `github_repo_secret`  |
| `github_repo`         | **USES**              | `github_env_secret`   |

- Extra 9 properties to `github_account` (`createdOn`, `updatedOn`,
  `description`, `email`, `node`, `databaseId`, `verified`, `location`,
  `websiteUrl`, `webLink`)
- Extra 6 properites to `github_team` (`createdOn`, `updatedOn`, `databaseId`,
  `description`, `node`, `privacy`)
- Extra 8 properties to `github_user` (`company`, `createdOn`, `updatedOn`,
  `databaseId`, `node`, `employee`, `location`, `websiteUrl`, `email`)
- Extra 19 properties to `github_repo` (`autoMergeAllowed`, `databaseId`,
  `deleteBranchOnMerge`, `description`, `homepageUrl`, `node`, `disabled`,
  `empty`, `fork`, `inOrganization`, `locked`, `mirror`,
  `securityPolicyEnabled`, `template`, `userConfigurationRepository`,
  `lockReason`, `mergeCommitAllowed`, `pushedOn`, `rebaseMergeAllowed`)
- Extra 5 properties to `github_pullrequest` (`databaseId`, `node`,
  `commitsCount`, `approvalsCount`, `approvalLastAt`)
- Pull requests Opened, Reviewed, or Approved by a user who is not part of the
  current organization or collaborator list now have a mapped relationship to a
  GitHub user with the login recorded in the PR properties.

### Changed

- `createdOn` and `updatedOn` properties for `github_org_secret`,
  `github_repo_secret`, and `github_app` are now time-since-epoch integers
  instead of strings, matching other entities.
- Steps that do not have enough token scope permission are now disabled instead
  of throwing errors.

## 1.4.5 - 2021-09-16

### Fixed

- Prevent error for when the head repository could not be determined for a pull
  request.

### Changed

- To query 25 pull requests at a time instead of 50 to prevent Github errors.

### Added

- Retry plugin to Octokit, which automatically retries upto 3 times for server
  4xx/5xx responses except 400, 401, 403 and 404.

## 1.4.4 - 2021-09-14

### Fixed

- Issue where collaborators step could fail when one repo has special
  permissions settings that prevent access to collaborators.
- Do not throw on 404 errors when fetching pull requests.
- Omit `members` and `repos` properties from the raw data of `github_team`
  entities.

## 1.4.3 - 2021-09-14

### Fixed

- Properly log graphQL errors.

## 1.4.2 - 2021-09-14

### Added

- Error logging to "Fetch Pull Requests" step.

## 1.4.1 - 2021-09-14

### Fixed

- Issue where changing data during the integration run could cause duplicate key
  errors and failure of some steps.
- Issue where fallback to the REST API for certain accounts could cause Repo
  ALLOWS Team relationships to only appear for one team.

## 1.4.0 - 2021-09-14

### Changed

- `github_pull_request` ingestion to use octokit v4 graphQL instead of the v3
  rest api.
- Commit analysis to be done on every `github_pull_request` regardless of if the
  `analyzeCommitApproval` config variable is set or not.

### Removed

- `analyzeCommitApproval` config variable.

### Added

- Retrying "Secondary Rate Limit" errors on graphQL queries.
- Better logging of graphQL queries.
- Added support for ingesting the following **new** entities:

| Resources          | Entity `_type`       | Entity `_class` |
| ------------------ | -------------------- | --------------- |
| GitHub Org Secret  | `github_org_secret`  | `Secret`        |
| GitHub Repo Secret | `github_repo_secret` | `Secret`        |

- Added support for ingesting the following **new** relationships:

| Source Entity `_type` | Relationship `_class` | Target Entity `_type` |
| --------------------- | --------------------- | --------------------- |
| `github_account`      | **HAS**               | `github_org_secret`   |
| `github_repo`         | **HAS**               | `github_repo_secret`  |
| `github_repo_secret`  | **OVERRIDES**         | `github_org_secret`   |
| `github_repo`         | **USES**              | `github_org_secret`   |
| `github_repo`         | **USES**              | `github_repo_secret`  |

### Fixed

- Remove `suspendedBy` property from `github_app` entity. The `suspendedBy`
  property is type `object`, which is not a supported entity property value
  type.

## 1.3.0 - 2021-08-27

### Added

- Properties added to graph objects:

  | Entity / Relationship     | Property                      | Notes               |
  | ------------------------- | ----------------------------- | ------------------- | ------- | ---------- | -------- | --- |
  | `github_repo_allows_team` | `adminPermission: boolean`    |                     |
  | `github_repo_allows_team` | `maintainPermission: boolean` |                     |
  | `github_repo_allows_team` | `pushPermission: boolean`     |                     |
  | `github_repo_allows_team` | `triagePermission: boolean`   |                     |
  | `github_repo_allows_team` | `pullPermission: boolean`     |                     |
  | `github_repo_allows_user` | `role: 'READ'                 | 'TRIAGE'            | 'WRITE' | 'MAINTAIN' | 'ADMIN'` |     |
  | `github_user`             | `webLink: string`             | GitHub user profile |

- Properties changed on graph objects:

  | Entity / Relationship     | Old                   | New            | Notes           |
  | ------------------------- | --------------------- | -------------- | --------------- |
  | `github_repo_allows_team` | `permissions: string` | `role: string` | Match GitHub UI |

## 1.2.3 - 2021-08-23

### Changed

- Role property for outside collaborators is now 'OUTSIDE'

## 1.2.0 - 2021-08-19

### Added

- Added support for ingesting the following **new** entities:

  | Entity                            |
  | --------------------------------- |
  | `github_app`                      |
  | `github_user` (`role: 'OUTSIDE'`) |

- Added support for ingesting the following **new** relationships:

  | Source           | class         | Target        |
  | ---------------- | ------------- | ------------- |
  | `github_account` | **INSTALLED** | `github_app`  |
  | `github_repo`    | **ALLOWS**    | `github_user` |

### Changed

- Changed relationship `github_team_allows_repo` to `github_repo_allows_team`,
  and added `permissions` property ('READ' | 'TRIAGE' | 'WRITE' | 'MAINTAIN' |
  'ADMIN')

### Fixed

- Removed incorrect relationship listing in documentation.

## 1.1.0 - 2021-07-26

### Added

- New properties on `github_pull_request`
  - `mergedOn`
  - `mergeCommitHash`

## 1.0.1 - 2021-07-23

### Removed

- `head` and `base` properties from `github_pull_request` entities' rawData.

### Fixed

- TypeError in `getCommitsToDestination` when a commit does not exist.

## 1.0.0 - 2021-07-09

### Added

- new optional config variable `useRestForTeamRepos` that can is sometimes
  needed to get around a GitHub error when fetching team repos via GraphQL.

### Changed

- octokit packages to be dependencies instead of peer dependencies.
- Integration now uses the `@jupiterone/integration-sdk-core`
- [JupiterOne/integrations#5](https://github.com/JupiterOne/integrations/issues/5)
  Use `name || login` for `displayName` of `Account` and `User` entities.

### Fixes

- Duplicate key bug in `github_user` **APPROVED** `github_pullrequest`
  relationships.
