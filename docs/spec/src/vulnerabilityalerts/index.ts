import { RelationshipClass, StepSpec } from '@jupiterone/integration-sdk-core';
import { IntegrationConfig } from '../../../../src/config';
import { Steps } from '../../../../src/constants';

export const vulnerabilityAlertSpec: StepSpec<IntegrationConfig>[] = [
  {
    id: 'fetch-github-vuln-alert',
    name: 'Fetch GitHub Vuln Alert',
    entities: [
      {
        resourceName: 'GitHub Vulnerability Alert',
        _type: 'github_finding',
        _class: 'Finding',
        schema: {
          properties: {
            id: { type: 'string' },
            name: { type: 'string' },
            displayName: { type: 'string' },
            summary: { type: 'string' },
            category: { type: 'string' },
            status: { type: 'string' },
            severity: { type: 'string' },
            numericSeverity: { type: 'number' },
            priority: { type: 'string' },
            score: { type: 'number' },
            impact: { type: 'string' },
            vector: { type: 'string' },
            recommendation: { type: 'string' },
            targets: {
              type: 'array',
              items: {
                type: 'string',
              },
            },
            open: { type: 'boolean' },
            references: { type: 'array', items: { type: 'string' } },
            public: { type: 'string' },
            weblink: { type: 'string' },
            createdOn: { type: 'number' },
            dismissedOn: { type: 'number' },
            dismisserLogin: { type: 'string' },
            dismissReason: { type: 'string' },
            fixReason: { type: 'string' },
            number: { type: 'number' },
            databaseId: { type: 'number' },
            ghsaId: { type: 'string' },
            origin: { type: 'string' },
            securityAdvisoryPublishedOn: { type: 'number' },
            securityAdvisoryUpdatedOn: { type: 'number' },
            withdrawnOn: { type: 'number' },
            packageName: { type: 'string' },
            packageEcosystem: { type: 'string' },
            vulnerableVersionRange: { type: 'string' },
            vulnerableManifestFilename: { type: 'string' },
            vulnerableManifestPath: { type: 'string' },
            vulnerableRequirements: { type: 'string' },
          },
        },
      },
      {
        resourceName: 'CVE',
        _type: 'cve',
        _class: 'Vulnerability',
        schema: {
          properties: {
            name: { type: 'string' },
            displayName: { type: 'string' },
            cvssScore: { type: 'string' },
            references: { type: 'array', items: { type: 'string' } },
            webLink: { type: 'string' },
          },
        },
      },
      {
        resourceName: 'CWE',
        _type: 'cwe',
        _class: 'Weakness',
        schema: {
          properties: {
            name: { type: 'string' },
            displayName: { type: 'string' },
            description: { type: 'string' },
            references: { type: 'array', items: { type: 'string' } },
            webLink: { type: 'string' },
          },
        },
      },
    ],
    relationships: [
      {
        _type: 'github_repo_has_finding',
        sourceType: 'github_repo',
        _class: RelationshipClass.HAS,
        targetType: 'github_finding',
      },
      {
        _type: 'github_finding_is_cve',
        sourceType: 'github_finding',
        _class: RelationshipClass.IS,
        targetType: 'cve',
      },
      {
        _type: 'github_finding_exploits_cwe',
        sourceType: 'github_finding',
        _class: RelationshipClass.EXPLOITS,
        targetType: 'cwe',
      },
    ],
    dependsOn: [Steps.FETCH_REPOS],
    implemented: false,
  },
];
